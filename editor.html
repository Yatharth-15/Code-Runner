<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Code Runner</title>
    <style>
        body { font-family: Arial, sans-serif; background: #e3f2fd; margin: 0; }
        header { background: #1565c0; color: #fff; text-align: center; padding: 12px; font-size: 22px; position: relative; }
        .logout { color: #fff; position: absolute; right: 20px; top: 12px; text-decoration: none; }
        .container { display: flex; justify-content: center; gap: 20px; margin: 30px; flex-wrap: wrap; }
        .box { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); }
        .editor { width: 65%; min-width: 300px; }
        .history { width: 25%; min-width: 200px; max-height: 500px; overflow-y: auto; }
        textarea, select, button { width: 100%; padding: 8px; margin: 8px 0; font-size: 14px; border-radius: 5px; }
        textarea { font-family: Consolas, monospace; height: 120px; border: 1px solid #ccc; }
        button { background: #1565c0; color: #fff; border: none; cursor: pointer; }
        button:hover { background: #0d47a1; }
        .output, .history-item { background: #f1f1f1; padding: 10px; border-radius: 5px; white-space: pre-wrap; }
        .history-item { margin: 6px 0; cursor: pointer; font-size: 13px; font-family: Consolas; }
        .history-item:hover { background: #bbdefb; }
        small { color: #555; font-style: italic; }
    </style>
</head>
<body>
    <header>Code Runner <a href="/logout" class="logout">Logout</a></header>

    <div class="container">
        <div class="box editor">
            <h3>Welcome, {{ username }}</h3>
            <form method="POST">
                <textarea id="code" name="code" placeholder="Write code...">{{ request.form.code or '' }}</textarea>
                <select name="language">
                    <option value="python">Python</option>
                    <option value="c">C</option>
                    <option value="cpp">C++</option>
                    <option value="java">Java</option>
                </select>
                <textarea name="user_input" placeholder="Inputs (comma separated)">{{ request.form.user_input or '' }}</textarea>
                <small>Use commas for multiple inputs.</small>
                <button type="submit">â–¶ Run</button>
            </form>

            {% if output %}
                <h4>Output:</h4>
                <div class="output">{{ output }}</div>
            {% endif %}
        </div>

        <div class="box history">
            <h4>History</h4>
            {% if user_history %}
                {% for item in user_history %}
                    <div class="history-item"
                         data-code="{{ item | replace('\'', '&#39;') | replace('\n', ' ') | replace('\r', '') }}">
                         {{ item[:50] }}{% if item|length > 50 %}...{% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <p style="color:#777;">No history yet.</p>
            {% endif %}
        </div>
    </div>

    <script>
        document.querySelectorAll('.history-item').forEach(el => {
            el.addEventListener('click', () => {
                document.getElementById('code').value = el.dataset.code;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
